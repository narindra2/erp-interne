$(document).ready((function(){var a='<div  class="blockui-message"><span class="spinner-border text-primary"></span> '+app_lang.please_wait+' <span id ="upload-info"></span></div>',t=document.querySelector("#ajax-modal-content"),e=new KTBlockUI(t,{message:a});!function(a){a.fn.appForm=function(t){var n=a.extend({},{ajaxSubmit:!0,submitBtn:"#submit",isModal:!0,forceBlock:!1,showProgress:!0,dataType:"json",showAlertSuccess:!0,onModalClose:function(){},onSuccess:function(){},onError:function(){return!0},onFail:function(){return!0},onSubmit:function(){},onAjaxSuccess:function(){},beforeAjaxSubmit:function(a,t,e){}},t),o=function(t,e=!0){a("#ajax-modal-callback").html(""),e?(a("#ajax-modal-callback").css("display","none"),t.attr("data-kt-indicator","on"),t.attr("disabled",!0)):(a("#ajax-modal-callback").css("display",""),t.attr("disabled",!1),t.removeAttr("data-kt-indicator"))};function r(t,e){a(t).validate({submitHandler:function(a){if(!e)return!0;e(a)},highlight:function(t){a(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){a(t).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"fv-plugins-message-container invalid-feedback help-block mt-2",ignore:":hidden:not(.validate-hidden)",errorPlacement:function(a,t){t.parent(".input-group").length?a.insertAfter(t.parent()):a.insertAfter(t)}}),a(".validate-hidden").click((function(){a(this).closest(".form-group").removeClass("has-error").find(".help-block").hide()}))}this.each((function(t){n.ajaxSubmit?r(a(this),(function(t){var r=a(n.submitBtn);n.onSubmit(),a(t).ajaxSubmit({dataType:n.dataType,beforeSubmit:function(a,t,s){o(r,!0),n.beforeAjaxSubmit(a,t,s),(n.isModal||n.forceBlock)&&e.block()},success:function(t){if(o(r,!1),n.onAjaxSuccess(t),!t.success){if(n.onError(t))if(n.isModal){if(e.release(),a("#ajax-modal-content").find('[type="submit"]').removeAttr("disabled"),a(".modal-mask").remove(),t.message){a("#ajax-modal-callback").attr("class","modal-body");let e=t.message;if(Array.isArray(t.message)){e="";for(let a=0;a<t.message.length;a++)e+=t.message[a]+"<br>"}return s.error(e,{container:"#ajax-modal-callback",animate:!1})}}else if(t.message)return n.forceBlock&&e.release(),a("#ajax-modal-callback").attr("class","modal-body"),toastr.error(t.message);return toastr.error(t.message)}n.onSuccess(t),n.isModal?(e.release(),n.showProgress&&a("#upload-info").html('<span class="text-primary">ok </span>'),function(t){t&&(a(".modal-mask").html("<div class='circle-done'><i class='fa fa-check'></i></div>"),setTimeout((function(){a(".modal-mask").find(".circle-done").addClass("ok")}),30));setTimeout((function(){a(".modal-mask").remove(),a("#ajax-modal").find(".modal-dialog").removeClass("modal-lg"),a("#ajax-modal").find(".modal-dialog").removeClass("modal-sm"),a("#ajax-modal").find(".modal-dialog").removeClass("modal-fullscreen"),a("#ajax-modal").modal("hide"),a("#ajax-modal-content").removeClass("blockui").html("").attr("style",""),n.onModalClose()}),1e3)}(!0),n.showAlertSuccess&&(t.info?toastr.error(t.message):toastr.success(t.message))):(n.forceBlock&&e.release(),n.showAlertSuccess&&toastr.success(t.message))},uploadProgress:function(t,e,s,o){if(n.showProgress){var r="primary";o>90&&(r="success");var i='<span class="text-'+r+'"> '+o+"% </span>";a("#upload-info").html(i)}},error:function(t,s,i){var l;n.onFail(t,s,i),o(r,!1),e.release(),toastr.options.timeOut=0,l=void 0!==t.responseJSON?t.responseJSON.message+" File : "+t.responseJSON.file+" Line : "+t.responseJSON.line:i;var d='<span class="text-danger">'+app_lang.error+"</span>";a("#upload-info").html(d),toastr.error("<p> Status : "+t.status+" </p> <p> MessageError : "+l+" </p>")}})})):r(a(this))}))}}(jQuery);var s={info:function(a,t){return this._settings=n(t),this._settings.alertType="info",o(a),"#"+this._settings.alertId},success:function(a,t){return this._settings=n(t),this._settings.alertType="success",o(a),"#"+this._settings.alertId},warning:function(a,t){return this._settings=n(t),this._settings.alertType="warning",o(a),"#"+this._settings.alertId},error:function(a,t){return this._settings=n(t),this._settings.alertType="error",o(a),"#"+this._settings.alertId},options:{container:"body",duration:0,showProgressBar:!0,clearAll:!0,animate:!0}};function n(a){if(!a)a={};return a.alertId="app-alert-"+function(){for(var a="",t="abcdefghijklmnopqrstuvwxyz0123456789",e=0;e<5;e++)a+=t.charAt(Math.floor(Math.random()*t.length));return a}(),this._settings=$.extend({},s.options,a)}function o(a){!function(){this._settings.clearAll&&$("[role='alert']").remove()}(),$(this._settings.container).length?(this._settings.animate&&setTimeout((function(){$(".app-alert").animate({opacity:1,right:"40px"},500,(function(){$(".app-alert").animate({right:"15px"},300)}))}),20),$(this._settings.container).prepend(function(a){var t="info";return"error"===this._settings.alertType?t="danger":"success"===this._settings.alertType?t="success":""===this._settings.alertType&&(t="waring"),this._settings.animate&&(t+=" animate"),'<div class="alert alert-dismissible bg-light-'+t+' border border-danger border-dashed d-flex flex-column flex-sm-row w-100 p-5 mb-2"><div class="d-flex flex-column pe-0 pe-sm-10"><h5 class="mb-1"> Messsage(s) : </h5><span> '+a+' </span></div><button type="button" class="position-absolute position-sm-relative m-2 m-sm-0 top-0 end-0 btn btn-icon ms-sm-auto" data-bs-dismiss="alert"><i class="bi bi-x fs-1 text-'+t+'"></i></button></div>'}(a)),function(){if(this._settings.duration&&this._settings.showProgressBar){var a="#"+this._settings.alertId,t=$(a).find(".progress-bar");t.removeClass("hide").width(0);var e="width "+this._settings.duration+"ms ease";t.css({WebkitTransition:e,MozTransition:e,MsTransition:e,OTransition:e,transition:e}),setTimeout((function(){$(a).length>0&&$(a).remove()}),this._settings.duration)}}()):console.log("appAlert: container must be an html selector!")}$("#ajax-modal").on("hidden.bs.modal",(function(a){$("#modal-dialog").attr("class","modal-dialog modal-dialog-centered"),$(this).find(".modal-dialog").addClass("modal-sm"),$("#ajax-modal-original-content").css("display",""),$("#ajax-modal-callback").html("")}));var r=document.querySelector("#ajax-drawer"),i=KTDrawer.getInstance(r),l=document.querySelector("#ajax-drawer-body"),d=new KTBlockUI(l,{message:a});$("body").on("click",'[data-act="ajax-drawer"]',(function(a){i.destroy();var t={_token:getCsrfToken()},e=$(this).attr("data-action-url"),s=$(this).attr("data-title");$("#ajax-drawer");return e?(s?$("#ajax-drawer-title").html(s):$("#ajax-drawer-title").text($("#ajax-drawer-title").attr("title")),console.log(s),$(this).each((function(){$.each(this.attributes,(function(){if(this.specified&&this.name.match("^data-post-")){var a=this.name.replace("data-post-","");t[a]=this.value}}))})),$(".dropdown-menu")&&$(".dropdown-menu").removeClass("show"),i.show(),d.block(),$.ajax({url:e,data:t,cache:!1,type:"POST",dataType:"json",success:function(a){d.release(),a.view?$("#ajax-drawer-content").html(a.view):$("#ajax-drawer-content").html(a),a.info&&$("#ajax-drawer-info").html(a.info)},statusCode:{404:function(){d.release()}},error:function(){d.release()}}),!1):(console.log("Ajax drawer: Set data-action-url!"),!1)})),i.on("kt.drawer.after.hidden",(function(){$("#ajax-drawer-content").html(""),$("#ajax-drawer-info").html(""),d.isBlocked()&&d.release()})),$("body").on("click",'[data-toggle="ajax-tab"]',(function(){var a=$(this);if(a.addClass("active"),loadurl=a.attr("data-load-url"),target=a.attr("href"),!target||!loadurl||"#"==loadurl)return!1;$(target).html('<div class="d-flex justify-content-center">\n        <div class="spinner-border text-primary" role="status">\n          <span class="visually-hidden">Loading...</span>\n        </div>\n            </div>'),$.get(loadurl,(function(a){$(target).html(a)})),a.show()})),$("body").on("click","[data-action=delete]",(function(a){var t=$(a.currentTarget),e=$(this).parents("table").attr("id"),s=$(this).parents("tr"),n=t.attr("data-reload-table");a.data&&a.data.target&&(t=a.data.target);var o=t.html();t.html(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');var r=t.attr("data-action-url"),i=t.attr("data-id"),l={id:i,_token:_token};$(this).each((function(){$.each(this.attributes,(function(){if(this.specified&&this.name.match("^data-post-")){var a=this.name.replace("data-post-","");l[a]=this.value}}))}));var d="";for(key in l)d+=" data-post-"+key+"="+l[key];$.ajax({url:r,type:"POST",dataType:"json",data:l,success:function(a){a.success?(void 0!==a.row_id&&void 0!==a.data?dataTableUpdateRow(dataTableInstance[e],a.row_id,a.data):(dataTableInstance[e].row(s).remove().draw(),s.fadeOut("slow")),void 0!==a.extra_data&&dataTableUpdateRow(dataTableInstance[a.extra_data.table],a.extra_data.row_id,a.extra_data.data),toastr.warning("<span data-table-instance-id-call-back-delete = "+e+">"+a.message+"</span> <span title="+app_lang.undo+" style='color:black' data-action-url="+r+" data-id ="+i+"data-reload-table="+n+" data-action='cancel-deleted' data-table-instance-id-call-back-delete="+e+" "+d+"  >"+(a.can_not_undo?"":"annuler")+"</span>")):(toastr.options.timeOut=0,toastr.error("<span data-table-instance-id-call-back-delete = "+e+">"+a.message+"</span>")),t.html(o)},error:function(a,t,e){toastr.options.timeOut=0,toastr.error("<span> Status : "+a.status+"MessageError : "+a.responseJSON.message?a.responseJSON.message:e+"File : "+a.responseJSON.file+"Line : "+a.responseJSON.line+" </span>")}})})),$("body").on("click","[data-action=cancel-deleted]",(function(a){var t=$(this),e=t.attr("data-action-url"),s=t.attr("data-id");reload=t.attr("data-reload-table");var n={id:s,_token:_token,cancel:!0};$(this).each((function(){$.each(this.attributes,(function(){if(this.specified&&this.name.match("^data-post-")){var a=this.name.replace("data-post-","");n[a]=this.value}}))})),tableInstance=t.attr("data-table-instance-id-call-back-delete"),$.ajax({url:e,type:"POST",dataType:"json",data:n,success:function(a){if(a.success){if(reload)return dataTableInstance[tableInstance].ajax.reload();void 0!==a.row_id&&void 0!==a.data?(dataTableUpdateRow(dataTableInstance[tableInstance],a.row_id,a.data),void 0!==a.extra_data&&dataTableUpdateRow(dataTableInstance[a.extra_data.table],a.extra_data.row_id,a.extra_data.data)):dataTableInstance[tableInstance].row.add(a.data).draw(),toastr.success(a.message)}},error:function(a,t,e){toastr.options.timeOut=0,toastr.error("<span> Status : "+a.status+"MessageError : "+a.responseJSON.message?a.responseJSON.message:e+"File : "+a.responseJSON.file+"Line : "+a.responseJSON.line+" </span>")}})})),$("body").on("click",'[data-act="data-mail-to"]',(function(a){var t=$(this).attr("data-title");t?$("#data-mail-to").html(t):$("#data-mail-to-title").text($("#data-mail-to-title").attr("title"));var e=$(a.target).text();$("#data_mail").is(":visible")?/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())?($("#mail_value").val(e),setTimeout((function(){$("#mail_to").trigger("click")}),100),setTimeout((function(){$("#email_content").focus(),window.scrollTo(0,document.body.scrollHeight)}),100)):$("#mail_to").trigger("click"):($("#mail_value").val(e),setTimeout((function(){$("#mail_to").trigger("click")}),100),setTimeout((function(){$("#email_content").focus(),window.scrollTo(0,document.body.scrollHeight)}),100))})),$('[data-toggle="ajax-tab"]')[0]&&$('[data-toggle="ajax-tab"]')[0].click()}));